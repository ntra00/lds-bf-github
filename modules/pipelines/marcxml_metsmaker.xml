<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cpf/pipelines.css" type="text/css"?>
<pipeline xsi:schemaLocation="http://marklogic.com/cpf/pipelines file:/Users/credding/marklogic/schemas/pipelines.xsd" xmlns="http://marklogic.com/cpf/pipelines" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <pipeline-name>MARCXML METS-Maker</pipeline-name>
  <pipeline-description>Convert MARCXML to METS/MODS/MXE. This pipeline should be used in conjunction with the basic conversion pipeline and the status change handling pipeline.</pipeline-description>
  <success-action>
    <module>/MarkLogic/cpf/actions/success-action.xqy</module>
  </success-action>
  <failure-action>
    <module>/MarkLogic/cpf/actions/failure-action.xqy</module>
  </failure-action>
  <state-transition>
    <annotation>Convert MARCXML documents (only) to METS documents.</annotation>
    <state>http://marklogic.com/states/initial</state>
    <on-success>http://marklogic.com/states/converted</on-success>
    <on-failure>http://marklogic.com/states/error</on-failure>
    <priority>9200</priority>
    <execute>
      <condition>
	<module>/MarkLogic/cpf/actions/namespace-condition.xqy</module>
	<options xmlns="/MarkLogic/cpf/actions/namespace-condition.xqy">
          <namespace>http://www.loc.gov/MARC21/slim</namespace>
        </options>
      </condition>
      <action>
	<module>/xq/cpf/convert-marcxml-mets-action.xqy</module>
	<options xmlns="/xq/cpf/convert-marcxml-mets-action.xqy">
          <destination-root>/catalog/lscoll/lcdb/bib/</destination-root>
          <destination-collection>/catalog/lscoll/lcdb/bib/</destination-collection>
        </options>
      </action>
    </execute>
  </state-transition>
  <state-transition>
    <annotation>Copy large MARCXML files over to production for METS making and processing</annotation>
    <state>http://marklogic.com/states/converted</state>
    <on-success>http://marklogic.com/states/final</on-success>
    <on-failure>http://marklogic.com/states/error</on-failure>
    <priority>9201</priority>
    <execute>
      <condition>
	<module>/MarkLogic/cpf/actions/namespace-condition.xqy</module>
	<options xmlns="/MarkLogic/cpf/actions/namespace-condition.xqy">
          <namespace>http://www.loc.gov/MARC21/slim</namespace>
        </options>
      </condition>
      <action>
	<module>/xq/cpf/marcxml-to-production-action.xqy</module>
      </action>
    </execute>
  </state-transition>
  <!--<state-transition>
    <state>http://marklogic.com/states/final</state>
    <priority>10000</priority>
    <execute>
      <condition>
        <module>/MarkLogic/cpf/actions/namespace-condition.xqy</module>
        <options xmlns="/MarkLogic/cpf/actions/namespace-condition.xqy">
          <namespace>http://www.loc.gov/MARC21/slim</namespace>
        </options>
      </condition>
      <action>
        <module>/xq/cpf/delete-ingested-marcxml-action.xqy</module>
      </action>
    </execute>
    </state-transition>-->
  <!--<status-transition>
    <annotation>Delete Reference Set XML</annotation>
    <status>done</status>
    <execute>
      <condition>
        <module>/MarkLogic/cpf/actions/namespace-condition.xqy</module>
        <options xmlns="/MarkLogic/cpf/actions/namespace-condition.xqy">
          <namespace>http://www.loc.gov/MARC21/slim</namespace>
        </options>
      </condition>
      <action>
        <module>/xq/cpf/delete-ingested-marcxml-action.xqy</module>
      </action>
    </execute>
  </status-transition>  -->
</pipeline>